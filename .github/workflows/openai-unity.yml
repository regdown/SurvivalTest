name: OpenAI Unity Automation

on:
  workflow_dispatch:
    inputs:
      task:
        description: '–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è GPT'
        required: true
        type: string

jobs:
  automate-task:
    runs-on: ubuntu-latest

    # ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è pull request –∏ –∫–æ–º–º–∏—Ç–æ–≤
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Request GPT response
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          pip install openai
          python - <<EOF
          import os
          import openai

          api_key = os.getenv('OPENAI_API_KEY')
          task = """${{ github.event.inputs.task }}"""

          openai.api_key = api_key

          response = openai.ChatCompletion.create(
              model="gpt-4o",  # ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ gpt-4o, –µ—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –¥–æ—Å—Ç—É–ø
              messages=[
                  {"role": "system", "content": "–¢—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ Unity –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é. –¢–µ–±—è –ø–æ–ø—Ä–æ—Å—è—Ç –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç Unity. –î–∞–π –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –∫–æ–¥."},
                  {"role": "user", "content": task}
              ]
          )

          answer = response['choices'][0]['message']['content']
          with open("GPT_Response.md", "w", encoding="utf-8") as f:
              f.write(answer)
          EOF

      - name: Commit and create PR
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: auto/openai-changes
          title: "ü§ñ GPT Automated changes"
          commit-message: "üõ†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç GPT"
          body: |
            –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é GPT:

            - –ó–∞–¥–∞—á–∞: ${{ github.event.inputs.task }}

            –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º–æ—Ç—Ä–∏ –≤ [GPT_Response.md].
